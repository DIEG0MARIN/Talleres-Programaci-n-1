---
title: "Clase 2 de ocubre"
output: html_document
date: "2025-10-02"
---
title: "dplyr Intermedio (versión sencilla)"
subtitle: "Con `mpg` (ggplot2) y joins pequeños de dplyr"
author: "Clase"
date: "`r format(Sys.Date())`"
output:
  html_document:
    toc: true
    toc_float: true
    number_sections: true
    theme: cosmo
editor_options:
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message = FALSE, warning = FALSE) # echo = FALSE => para ocultar mi codigo
```

## 0) Paquetes y datos

Usaremos una base *pequeña* (`mpg`) para transformar y resumir, y dos tibbles diminutas para *joins*.

```{r}
library(tidyverse)   # dplyr, ggplot2, etc.
library(ggplot2)     # trae la base mpg

```

### 0.1 Copia en español de `mpg` (solo nombres)

```{r}
autos <- ggplot2::mpg |>
  rename(
    fabricante = manufacturer,
    modelo = model,
    cilindraje = displ,
    anio = year,
    cilindros = cyl,
    transmision = trans,
    traccion = drv,
    ciudad_mpg = cty,
    autopista_mpg = hwy,
    combustible = fl,
    clase = class
  )

glimpse(autos)
```

---

## 1) Transformaciones intermedias (suaves)

### 1.1 `across()` para varias columnas a la vez

Objetivo: calcular media y desviación de **rendimiento** en ciudad y autopista por `clase`.



```{r}
resumen_rend <- autos %>% 
  group_by(clase) %>% 
  summarise(media = mean(ciudad_mpg),
            desviacion = sd(ciudad_mpg),
            media2 = mean(autopista_mpg)
  )




```


```{r}
resumen_rend <- autos %>% 
  group_by(clase) %>% 
  summarise(
    acoss(c("ciudad_mpg", "autopista_mpg"), # aqui se coloca la lista de columnas a las cuales se les aplicara las funciones
          list(media = ~mean(.x, na.rm = TRUE),
                    desviacion = ~sd(.x,na.rm = TRUE)# aQUI SE LISTA LOS RESULTADOS Y SE APLICAN LAS FUNCIONESA CADA ELEMENTO DE LA LISTA QUE SE DEFINIO PRIMERO
                    
          ),    
               .names = "{col}_{.fn}"
               
          ),
    
    Frecuencia = n()
    
  )



```


### 1.2 Función Slice : Selecciona filas por posición o criterio

Muestra el top 5 de los autos con mayor rendimiento en carretera.también toma una muestra aleatoria para mostrar en tabla


```{r}


mejores_autopista <- autos %>% 
  slice_max(autopista_mpg, n = 5, with_ties = F) # CON LA FUNCIÓN WITH_TIES EN ESTE CASO SE VEN LOS EMPATES DE LA condición  %>% 
select(fabricante,modelo,clase,ciudad_mpg,autopista_mpg)

muestra_rapida <- autos %>% 
  slice_sample( n= 3)  %>% 
  
select(fabricante,modelo,clase,ciudad_mpg,autopista_mpg)
muestra_rapida



```


 
### 1.3 Función case_when(): crea variables categoricas según condiciones


Crear una variable categorica usando la variable "cilindraje" , como sigue: bajo (<=2), medio (2-3.5), alto (>3.5).



```{r}

autos_etq <- autos %>% 
  
  mutate(
    
    etq_cilindraje = case_when(
      cilindraje <= ~ "Bajo", # aqui se coloca la primera condición y su correspondiente etiqueta
      cilindraje > 2 & cilindraje <= 3.5 ~ "Medio", # segunda condición
      cilindraje > 3.5 ~ "Alto",
      TRUE ~ NA_character_
      
    )
    
    
  )



autos_etq %>%  count(etq_cilindraje, sort = TRUE)

```



### 1.4 Joins (versión simple)

Usaremos las mini tablas que tiene dplyr, para parcticar los joins


```{r}

dplyr :: band_members
dplyr :: band_instruments
dplyr :: band_instruments2

```

### 3.1 "inner_join" y "left_join"

```{r}

instrumentos_inner <- inner_join(
  
  band_members, # primera tabla
  band_instruments, # segunda tabla
  by = "name",
 
)

 instrumentos_inner
 
 instrumentos_left <- left_join(
   
   band_members, # primera tabla
  band_instruments, # segunda tabla
  by = "name",
   
 )
 
 instrumentos_left

```































